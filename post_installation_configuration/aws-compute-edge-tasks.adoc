:_content-type: ASSEMBLY
:context: aws-compute-edge-tasks
[id="aws-compute-edge-tasks"]
= AWS Local Zone tasks
include::_attributes/common-attributes.adoc[]

toc::[]

After installing {product-title} in AWS with support of Local Zones and edge compute pool,
you can further expand and customize your cluster to your requirements.

[id="extend_existing_to_local_zones_day2"]
== Extend existing clusters to use AWS Local Zones

> TODO

To create worker nodes in AWS Local Zones in existing clusters it is required those steps:

- Make sure the overlay network MTU is set correctly to support the AWS Local Zone limitations
- Create subnets in AWS Local Zones, and dependencies (subnet association)
- Create MachineSet to deploy compute nodes in Local Zone subnets

When the cluster is installed using the edge compute pool, the MTU for the overlay network is automatically adjusted depending on the network plugin used.

When the cluster was already installed without the edge compute pool, without Local Zone support, the required dependencies must be satisfied. The steps below cover both scenarios.

=== Prerequisites

* You must check the free CIDR Blocks available on the VPC

// Opt-In Zone
include::modules/installation-aws-add-local-zone-locations.adoc[leveloffset=+2]

// MTU
include::modules/nw-cluster-mtu-change-about.adoc[leveloffset=+2]
include::modules/nw-cluster-mtu-change.adoc[leveloffset=+2]

// Create Subnet
include::modules/installation-creating-aws-subnet-localzone.adoc[leveloffset=+2]
include::modules/installation-cloudformation-subnet-localzone.adoc[leveloffset=+2]

// MachineSet creation
// TODO: instruct how to get zone info (I think it already exists in 4.14)
//Sample YAML for a compute machine set custom resource on AWS
include::modules/machineset-yaml-aws.adoc[leveloffset=+2]

//Creating a compute machine set
include::../includes/machineset-creating.adoc[leveloffset=+2]


// Verifying nodes that were created with edge compute pool
include::modules/machine-edge-pool-review-nodes.adoc[leveloffset=+2]


[id="creating-workloads-local-zones"]
== Creating workloads in AWS Local Zones

If you incorrectly sized the worker nodes during deployment, adjust them by creating one or more new compute machine sets, scale them up, then scale the original compute machine set down before removing them.

[id="sample-deployment-all-locations_{context}"]
=== Sample deployment across all Local Zone locations

> TODO

[id="csample-deployment-single-group_{context}"]
=== Sample deployment selecting single zone group

> TODO

[id="sample-deployment-storage_{context}"]
=== Sample deployment customizing storage

> TODO

[id="sample-deployment-service_{context}"]
=== Sample deployment exposing a service

> TODO

[id="sample-deployment-albo_{context}"]
=== Sample deployment using AWS Load Balancer Operator

> TODO

.Next steps

* Optional: Use the AWS Load Balancer (ALB) Operator to expose a pod from a targeted edge worker node to services that run inside a Local Zone subnet from a public network. See xref:../networking/aws_load_balancer_operator/install-aws-load-balancer-operator.adoc#nw-installing-aws-load-balancer-operator_aws-load-balancer-operator[Installing the AWS Load Balancer Operator].

[id="sample-deployment-full_{context}"]
=== Full Example

include::modules/installation-extend-edge-nodes-aws-local-zones.adoc[leveloffset=+2]


[role="_additional-resources"]
.Additional resources

* xref:../installing/installing_aws/installing-aws-localzone.adoc[Installing a cluster using AWS Local Zones]

* xref:../nodes/scheduling/nodes-scheduler-taints-tolerations.adoc[Understanding taints and tolerations]