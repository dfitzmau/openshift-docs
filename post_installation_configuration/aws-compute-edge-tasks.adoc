:_content-type: ASSEMBLY
:context: aws-compute-edge-tasks
[id="aws-compute-edge-tasks"]
= AWS Local Zone tasks
include::_attributes/common-attributes.adoc[]

toc::[]

After installing {product-title} in AWS, you can further expand and customize your cluster
to your requirements with support of Local Zones and edge compute pool.

[id="extend_existing_to_local_zones_day2"]
== Extend existing clusters to use AWS Local Zones

You can extend an existing {product-title} installation in AWS to use AWS Local Zones for Day 2 operations.

To extend nodes to Local Zone locations, you must create a subnet in the VPC for the target zone,
adjust the cluster network MTU, and create the Machine set manifest to create the node
into that location.

[role="_additional-resources"]
.Additional resources

* See link:https://aws.amazon.com/about-aws/global-infrastructure/localzones/features/[AWS Local Zones features] in the AWS documentation for more information about AWS Local Zones and the supported instances types and services.

.Prerequisites

* You must check the free CIDR Blocks available on the VPC

// Edge Compute Pool
include::modules/machines-edge-machine-pool.adoc[leveloffset=+2]

// Opt-In Zone
include::modules/installation-aws-add-local-zone-locations.adoc[leveloffset=+2]

[id="extend_existing_to_local_zones_day2_mtu"]
=== Changing the Cluster Network MTU to support AWS Local Zones subnets

.Prerequisites

* Cluster installed without the support of AWS Local Zones

// MTU
include::modules/nw-cluster-mtu-change-about.adoc[leveloffset=+3]
include::modules/nw-cluster-mtu-change.adoc[leveloffset=+3]

[id="extend_existing_to_local_zones_day2_subnet"]
=== Creating subnet

You must create a subnet in the Local Zone to allow Machine API to create instances
in the remote zones. You can use any provisioning tool to create subnets in the AWS
VPC. The examples below use CloudFormation Templates used in the installation option.

You can reuse it to create subnets for each edge location you need to extend the cluster to.

.Prerequisites

* You must check the free CIDR Blocks available on the VPC

// Create a Subnet
include::modules/installation-creating-aws-subnet-localzone.adoc[leveloffset=+3]
include::modules/installation-cloudformation-subnet-localzone.adoc[leveloffset=+3]

[id="extend_existing_to_local_zones_day2_machineset"]
=== Creating MachineSet for AWS Local Zones node

For each subnet created in the AWS Local Zones, you must create a new Machine Set manifest
to create nodes in those zones.

The steps below share how to create the machine set setting the same `edge` configuration
as the installer program for the `edge` compute pool when installing a cluster.

// MachineSet creation
// TODO: instruct how to get zone info (I think it already exists in 4.14)
//Sample YAML for a compute machine set custom resource on AWS
include::modules/machineset-yaml-aws.adoc[leveloffset=+3]

//Creating a compute machine set
include::modules/machineset-creating.adoc[leveloffset=+3]

[role="_additional-resources"]
.Additional resources

* xref:../installing/installing_aws/installing-aws-localzone.adoc[Installing a cluster using AWS Local Zones]

// Creating user workloads in AWS Local Zones
include::modules/installation-extend-edge-nodes-aws-local-zones.adoc[leveloffset=+1]

.Next steps

* Optional: Use the AWS Load Balancer (ALB) Operator to expose a pod from a targeted edge worker node to services that run inside a Local Zone subnet from a public network. See xref:../networking/aws_load_balancer_operator/install-aws-load-balancer-operator.adoc#nw-installing-aws-load-balancer-operator_aws-load-balancer-operator[Installing the AWS Load Balancer Operator].

[role="_additional-resources"]
.Additional resources

* xref:../installing/installing_aws/installing-aws-localzone.adoc[Installing a cluster using AWS Local Zones]

* xref:../nodes/scheduling/nodes-scheduler-taints-tolerations.adoc[Understanding taints and tolerations]